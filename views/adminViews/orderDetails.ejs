<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ride.</title>
  <link rel="icon" type="image/x-icon" href="../../public/admin/img/favicon/favicon.ico" />
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <!-- ajax -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
  <style>
    body {
      background-color: #f5f5f9;
    }

    .box {
      background-color: white;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
  </style>

  <div class="container mt-5">
    <div class="row">
      <div class="col box p-4">
        <table class="table">
          <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Total</th>
          </tr>
          <% order.products.forEach(function(product){ %>
            <tr>
              <td class="d-flex align-items-center p-2">
                <img src="/<%=product.productId.imageUrl[0]%>" alt="Img" style="width: 50px;">
                <%= product.productId.productName%>
              </td>
              <td>
                <%= product.quantity %>
              </td>
              <td>
                <%= product.productId.price %>
              </td>
              <td>
                <%= product.total %>
              </td>
            </tr>
            <% }) %>
              <tr>
                <td colspan="3" class="text-end"><strong>Grand Total</strong></td>
                <td> <strong>â‚¹ <%=order.total%></strong></td>
              </tr>
        </table>
      </div>
    </div>
    <div class="row box mt-3 d-flex align-items-center ">
      <div class="col-md-4 text-center p-2" id="orderStatus">
        <strong>Current order status :</strong> <span class="border">
           <%= order.orderStatus %>
        </span>
      </div>
      <div class="col-md-8  p-2 text-center">
        <button class="btn btn-outline-info m-2" onclick="changeStatus('<%= order._id %>', 'Packed')">Packed</button>
        <button class="btn btn-outline-primary m-2"onclick="changeStatus('<%= order._id %>', 'Shipped')">Shipped</button>
        <button class="btn btn-outline-success m-2"onclick="changeStatus ('<%= order._id %>', 'Delivered')">Delivered</button>
        <button class="btn btn-outline-danger m-2" onclick="changeStatus('<%= order._id %>','Cancelled')">Cancel</button>
      </div>
    </div>
    <div class="row my-3 box">
      <div class="col-12 col-md-6 border">
        <h5 class="text-center p-2">Shipping Address</h5>
        <div class="ps-3 pt-3">
          <p>Full name: <%= order.address.fullName %>
          </p>
          <p>Phone no : <%= order.address.phoneNumber %>
          </p>
          <p>Address : <%= order.address.address %>, <%= order.address.city %>, <%= order.address.state %> - <%=
                    order.address.pincode %>
          </p>
          <p>Type : <%= order.address.type %>
          </p>
        </div>
      </div>
      <div class="col-12 col-md-6 text-center border">
        <h5 class="p-2 text-center">Other Details</h5>
        <div>
          <p>Order Id : <%= order._id%></p>
          <p>Order date : <%= moment(order.date).format("LL") %> </p>
          <p>Payment Method : <%= order.paymentMethod %></p>
          <p>Payment Status : <%= order.paymentStatus %></p>
        </div>
        </p>
      </div>
    </div>
  </div>

  <script>
    function changeStatus(OrderId, Status) {
      console.log(OrderId, Status)
      $.ajax({
        url: '/admin/changeOrderStatus',
        data: {
          status: Status,
          orderId: OrderId
        },
        method: 'post',
        success: (response) => {
          if (response) {
            $("#orderStatus").load(" #orderStatus > *");
            Swal.fire({
              icon: 'success',
              title: Status,
              text: 'Order status updated successfully.',
              showConfirmButton: false,
              timer: 1500
            })
          }
        }
      })
    }
  </script>

  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
</body>

</html>